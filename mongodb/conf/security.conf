# MongoDB Security Configuration
# Security best practices and hardening

# Enable authentication
# Add to mongod.conf:
# security:
#   authorization: enabled

# Disable HTTP interface
# Add to mongod.conf:
# net:
#   http:
#     enabled: false
#     RESTInterfaceEnabled: false

# Bind to localhost only (or specific IPs)
# Add to mongod.conf:
# net:
#   bindIp: 127.0.0.1                    # Bind to localhost only for security

# Enable SSL/TLS
# Add to mongod.conf:
# net:
#   ssl:
#     mode: requireSSL
#     PEMKeyFile: /etc/ssl/mongodb.pem
#     PEMKeyFile: /etc/ssl/mongodb.key
#     CAFile: /etc/ssl/mongodb-ca.crt

# Enable audit logging
# Add to mongod.conf:
# auditLog:
#   destination: file
#   format: JSON
#   path: /var/log/mongodb/audit.log
#   filter: '{ "atype": "authenticate", "ts": { "$date": "%Y-%m-%dT%H:%M:%S.%LZ" } }'

# Enable encryption at rest
# Add to mongod.conf:
# storage:
#   wiredTiger:
#     encryption:
#       enabled: true
#       kms:
#         provider: "aws"
#         accessKeyId: "YOUR_ACCESS_KEY"
#         secretAccessKey: "YOUR_SECRET_KEY"
#         region: "us-east-1"

# Set parameter for security
# Add to mongod.conf:
# setParameter:
#   enableLocalhostAuthBypass: false
#   authenticationMechanisms: SCRAM-SHA-1

# Security roles and permissions:
# 
# Database User Roles:
# - read: Read access to database
# - readWrite: Read and write access to database
# - dbAdmin: Database administration
# - dbOwner: Database owner (full access)
# - userAdmin: User management
# - readAnyDatabase: Read access to all databases
# readWriteAnyDatabase: Read/write access to all databases
# userAdminAnyDatabase: User management across all databases
# dbAdminAnyDatabase: Database administration across all databases
# 
# Cluster Roles:
# - clusterAdmin: Cluster administration
# - clusterManager: Cluster management
# - clusterMonitor: Cluster monitoring
# - hostManager: Host management
# 
# Built-in Roles:
# - backup: Can perform backup/restore operations
# - clusterMonitor: Can monitor cluster
# - read: Can read from any database
# - restore: Can perform restore operations
# - readWrite: Can read/write from any database

# Security Best Practices:
# 1. Always enable authentication in production
# 2. Use strong passwords and key files
# 3. Limit network exposure (bind to specific IPs)
# 4. Enable SSL/TLS for all connections
# 5. Use principle of least privilege for user roles
# 6. Enable audit logging for compliance
# 7. Use encryption at rest for sensitive data
# 8. Regularly rotate passwords and certificates
# 9. Monitor for suspicious activity
# 10. Keep MongoDB updated to latest version

# Network Security:
# - Use firewall to restrict access to MongoDB port (27017)
# - Bind to localhost only (127.0.0.1) for maximum security
# - Use VPN or SSH tunnel for remote access
# - Implement IP whitelisting if needed (not recommended with localhost binding)
# - Disable HTTP interface in production

# User Security:
# - Create separate users for different applications
# - Use application-specific databases
# - Implement proper password policies
# - Regularly review and remove unused accounts
# - Use role-based access control (RBAC)

# Example Security Configuration:
# 
# 1. Create admin user with clusterAdmin role:
# use admin
# db.createUser({
#   user: "admin",
#   pwd: "strong_password_here",
#   roles: [
#     { role: "userAdminAnyDatabase", db: "admin" },
#     { role: "dbAdminAnyDatabase", db: "admin" },
#     { role: "clusterAdmin", db: "admin" }
#   ]
# })
# 
# 2. Create application user with limited permissions:
# use myapp
# db.createUser({
#   user: "myapp_user",
#   pwd: "app_password_here",
#   roles: [
#     { role: "readWrite", db: "myapp" }
#   ]
# })
# 
# 3. Create backup user:
# use admin
# db.createUser({
#   user: "backup_user",
#   pwd: "backup_password_here",
#   roles: [
#     { role: "backup", db: "admin" },
#     { role: "clusterMonitor", db: "admin" }
#   ]
# })

# Connection Security:
# - Always use authentication in connection strings
# - Use SSL/TLS certificates
# - Validate server certificates
# - Use connection pooling with proper configuration
# - Implement connection timeouts
# - Connect via localhost only (127.0.0.1:27017)

# Example Secure Connection String (localhost only):
# mongodb://username:password@127.0.0.1:27017/database?ssl=true&sslCertValidate=true

# Example SSH Tunnel for Remote Access:
# ssh -L 27017:127.0.0.1:27017 user@server
# Then connect to localhost:27017

# Monitoring and Alerting:
# - Monitor authentication failures
# - Alert on unusual access patterns
# - Monitor database performance metrics
# - Set up alerts for security events
# - Regular security audits
