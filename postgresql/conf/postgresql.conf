# PostgreSQL Main Configuration
# Optimized for performance and security

# Connection Settings
listen_addresses = '127.0.0.1'            # Listen only on localhost for security
port = 5432                             # Port for PostgreSQL to listen on
max_connections = 200                    # Maximum number of concurrent connections
superuser_reserved_connections = 3       # Number of connections reserved for superusers

# Memory Settings
shared_buffers = 256MB                  # Amount of memory the database server uses for shared memory buffers
effective_cache_size = 1GB              # Set to roughly 3/4 of physical memory
work_mem = 4MB                          # Amount of memory to be used by internal sort operations and hash tables
maintenance_work_mem = 128MB             # Memory used for maintenance operations (VACUUM, CREATE INDEX, etc.)

# WAL Settings
wal_level = replica                     # Minimal WAL level for archiving and replication
max_wal_senders = 10                    # Maximum number of concurrent WAL sender processes
max_replication_slots = 10              # Maximum number of simultaneously running replication processes
wal_buffers = 16MB                     # Disk space for WAL buffers that were not written out
wal_writer_delay = 200ms               # Delay between WAL flush operations
commit_delay = 0                       # Delay between transaction commit and flushing WAL to disk

# Checkpoint Settings
checkpoint_completion_target = 0.7       # Controls whether checkpoint completion is spread across the checkpoint interval
checkpoint_segments = 32                # Maximum number of log file segments between automatic WAL checkpoints
checkpoint_timeout = 5min               # Maximum time between automatic WAL checkpoints

# Logging Settings
logging_collector = on                  # Enable capturing of stderr and csvlog into log files
log_directory = 'pg_log'                # Directory where log files are written
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'  # Log file name pattern
log_rotation_age = 1d                   # Automatic log file rotation will occur after this time
log_rotation_size = 100MB               # Automatic log file rotation will occur after this much log output
log_min_messages = warning              # Messages that are written to the server log
log_min_error_statement = error         # Controls which SQL statements are logged
log_connections = on                    # Logs each successful connection
log_disconnections = on                 # Logs end of each successful session
log_duration = on                      # Logs the duration of each completed SQL statement
log_statement = 'all'                   # Logs all SQL statements
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '  # Controls information prefixed to each log line

# Performance Settings
random_page_cost = 1.1                  # Sets the planner's estimate of the cost of a nonsequentially fetched disk page
effective_io_concurrency = 200           # Number of simultaneous disk I/O operations that PostgreSQL expects can be executed concurrently
maintenance_work_mem = 128MB            # Memory used for maintenance operations
autovacuum = on                         # Enables the autovacuum daemon
autovacuum_max_workers = 3               # Maximum number of autovacuum worker processes
autovacuum_naptime = 1min                # Time between autovacuum runs

# Authentication Settings
authentication_timeout = 1min            # Maximum time to complete client authentication
password_encryption = scram-sha-256      # The algorithm to use when encrypting passwords

# SSL Settings
ssl = on                                # Enables SSL connections
ssl_cert_file = 'server.crt'            # Location of the SSL server certificate file
ssl_key_file = 'server.key'             # Location of the SSL server private key file
ssl_ca_file = 'root.crt'                # Location of the SSL certificate authority file

# Locale Settings
lc_messages = 'en_US.UTF-8'             # Locale for system error message messages
lc_monetary = 'en_US.UTF-8'             # Locale for formatting monetary amounts
lc_numeric = 'en_US.UTF-8'              # Locale for formatting numbers
lc_time = 'en_US.UTF-8'                 # Locale for formatting date/time values

# Default Text Search Configuration
default_text_search_config = 'pg_catalog.english'

# Include configuration files
include_dir = 'conf.d'                  # Include files ending in '.conf' from the specified directory
