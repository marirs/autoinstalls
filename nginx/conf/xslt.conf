# XSLT Module Configuration
# Provides XML/XSLT transformation capabilities

# Basic XSLT transformation
location /xml/ {
    # Transform XML using XSLT stylesheet
    xslt_stylesheet /path/to/stylesheet.xsl;
    xslt_types text/xml application/xml;
    
    root /var/www;
}

# RSS feed generation
location /rss/ {
    # Transform XML data to RSS feed
    xslt_stylesheet /etc/nginx/xslt/rss.xsl;
    xslt_types application/xml;
    
    # Generate RSS from XML data
    try_files /data/$arg_feed.xml =404;
}

# HTML transformation from XML
location /html/ {
    # Convert XML to HTML using XSLT
    xslt_stylesheet /etc/nginx/xslt/html.xsl;
    xslt_types text/xml application/xml;
    
    root /var/www/xml;
}

# API response transformation
location /api/xml/ {
    # Transform XML API responses
    xslt_stylesheet /etc/nginx/xslt/api.xsl;
    xslt_types application/xml text/xml;
    
    proxy_pass http://backend;
}

# Conditional XSLT based on parameter
location /transform/ {
    # Choose stylesheet based on parameter
    if ($arg_format = "html") {
        xslt_stylesheet /etc/nginx/xslt/html.xsl;
    }
    if ($arg_format = "json") {
        xslt_stylesheet /etc/nginx/xslt/json.xsl;
    }
    
    xslt_types text/xml application/xml;
    root /var/www/xml;
}

# XSLT parameters example
location /parametrized/ {
    # Pass parameters to XSLT stylesheet
    xslt_stylesheet /etc/nginx/xslt/param.xsl;
    xslt_param param1 "value1";
    xslt_param param2 "value2";
    
    xslt_types text/xml application/xml;
    root /var/www/xml;
}

# Multiple XSLT types
location /multi/ {
    # Support multiple output formats
    xslt_stylesheet /etc/nginx/xslt/multi.xsl;
    xslt_types text/xml application/xml;
    
    # Content negotiation based on Accept header
    add_header Vary Accept;
    
    root /var/www/xml;
}

# Error handling for XSLT
error_page 422 /xslt-error.html;
location = /xslt-error.html {
    internal;
    root /var/www/errors;
}

# Performance considerations:
# - XSLT transformation is CPU intensive
# - Cache transformed content when possible
# - Use simple XSLT stylesheets for better performance
# - Consider pre-processing for static content

# XSLT stylesheet example (rss.xsl):
# <?xml version="1.0" encoding="UTF-8"?>
# <xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
#     <xsl:output method="xml" encoding="UTF-8"/>
#     <xsl:template match="/">
#         <rss version="2.0">
#             <channel>
#                 <title>My RSS Feed</title>
#                 <xsl:apply-templates select="//item"/>
#             </channel>
#         </rss>
#     </xsl:template>
#     <xsl:template match="item">
#         <item>
#             <title><xsl:value-of select="title"/></title>
#             <link><xsl:value-of select="link"/></link>
#         </item>
#     </xsl:template>
# </xsl:stylesheet>
