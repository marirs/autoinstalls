# Substitutions Filter Module Configuration
# Provides advanced text replacement in HTTP responses

# Basic text substitution example
location / {
    # Replace all occurrences of "old-domain.com" with "new-domain.com"
    subs_filter 'old-domain.com' 'new-domain.com' gi;
    subs_filter 'http://' 'https://' gi;
    
    # Your regular content here
}

# HTML content modification
location ~* \.html$ {
    # Add analytics tracking to all pages
    subs_filter '</head>' '</head><script>console.log("analytics loaded");</script>';
    
    # Replace version numbers
    subs_filter 'v1\.0\.0' 'v2.0.0' g;
}

# API response modification
location /api/ {
    # Modify API responses
    subs_filter '"status":"ok"' '"status":"success"' g;
    subs_filter '"api_version":"1"' '"api_version":"2"' g;
    
    proxy_pass http://backend;
}

# CDN integration example
location /static/ {
    # Replace local paths with CDN URLs
    subs_filter '/static/images/' 'https://cdn.example.com/images/' g;
    subs_filter '/static/css/' 'https://cdn.example.com/css/' g;
    
    root /var/www;
}

# Content security headers modification
location / {
    # Add CSP headers to HTML responses
    subs_filter '<head>' '<head><meta http-equiv="Content-Security-Policy" content="default-src \'self\'">';
    
    # Remove unwanted headers
    subs_filter 'X-Powered-By:.*\r\n' '' g;
}

# Multiple substitution rules
location /blog/ {
    # Blog content modifications
    subs_filter 'example.com' 'newblog.example.com' gi;
    subs_filter '© 2023' '© 2025' g;
    subs_filter 'author="admin"' 'author="editor"' g;
    
    # Regex-based substitution
    subs_filter 'src="/images/(.*?)"' 'src="/optimized/images/$1"' gir;
}

# Performance considerations
# - Substitutions are processed on each response
# - Use regex sparingly (performance impact)
# - Consider caching for static content

# Substitution flags:
# g - global replacement (replace all occurrences)
# i - case insensitive matching  
# r - regex matching
# o - single match (default)
