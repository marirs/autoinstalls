# Enhanced Security Configuration
# Additional security headers and hardening rules

# Additional security headers for browser protection
add_header X-Permitted-Cross-Domain-Policies "none" always;
add_header X-Download-Options "noopen" always;
add_header X-Robots-Tag "none" always;

# Hide server information from responses
server_tokens off;
more_clear_headers Server;
more_clear_headers X-Powered-By;

# Allow only standard HTTP methods, block others
if ($request_method !~ ^(GET|HEAD|POST|PUT|DELETE|OPTIONS)$ ) {
    return 405;
}

# Block access to hidden files (starting with dot)
location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
}

# Block access to temporary files (ending with tilde)
location ~ ~$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Block access to backup and archive files
location ~* \.(bak|backup|old|orig|save|tmp)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Block access to configuration and sensitive files
location ~* \.(conf|config|ini|log|sh|sql|tar|gz|zip)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Request size and timeout limits
client_max_body_size 10M;
client_header_buffer_size 1k;
large_client_header_buffers 4 4k;

# Connection timeout and buffer settings
client_body_timeout 12s;
client_header_timeout 12s;
send_timeout 10s;
keepalive_timeout 30;
keepalive_requests 1000;

# Connection management
reset_timedout_connection on;
client_body_buffer_size 128k;
client_header_buffer_size 1k;
client_max_body_size 10M;
large_client_header_buffers 4 4k;

# Additional security
reset_timedout_connection on;
client_body_timeout 10;
client_header_timeout 10;
send_timeout 2;
keepalive_timeout 30;
keepalive_requests 1000;

# Hide server tokens
server_tokens off;
